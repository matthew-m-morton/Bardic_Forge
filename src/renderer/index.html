<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'">
    <title>Bardic Forge</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="settings-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <h1>BARDIC FORGE</h1>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item" data-view="songs">
                    <span class="nav-icon">üéµ</span>
                    <span class="nav-label">Songs</span>
                </div>
                
                <div class="nav-item" data-view="albums">
                    <span class="nav-icon">üíø</span>
                    <span class="nav-label">Albums</span>
                </div>
                
                <div class="nav-item" data-view="artists">
                    <span class="nav-icon">üé§</span>
                    <span class="nav-label">Artists</span>
                </div>
                
                <div class="nav-section">
                    <div class="nav-item" data-view="playlists">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-label">Playlists</span>
                    </div>
                    <div class="playlist-list" id="playlistList">
                        <!-- Playlists will be dynamically added here -->
                    </div>
                    <button class="add-playlist-btn" id="addPlaylistBtn">
                        <span>‚ûï New Playlist</span>
                    </button>
                </div>
            </nav>
            
            <!-- Album Art Display -->
            <div class="album-art-container">
                <div class="album-art" id="albumArt">
                    <span class="album-placeholder">‚ô™</span>
                </div>
                <div class="now-playing-info">
                    <div class="song-title" id="nowPlayingTitle">No song playing</div>
                    <div class="song-artist" id="nowPlayingArtist"></div>
                </div>
                
                <!-- Playback Controls -->
                <div class="playback-controls">
                    <button class="control-btn" id="prevBtn" title="Previous">‚èÆ</button>
                    <button class="control-btn play-btn" id="playBtn" title="Play">‚ñ∂</button>
                    <button class="control-btn" id="nextBtn" title="Next">‚è≠</button>
                </div>
                
                <!-- Additional Controls -->
                <div class="extra-controls">
                    <button class="control-btn small" id="shuffleBtn" title="Shuffle" style="text-decoration: line-through;">üîÄ</button>
                    <button class="control-btn small" id="repeatBtn" title="Repeat" style="text-decoration: line-through;">üîÅ</button>
                    <div class="volume-control">
                        <button class="control-btn small" id="volumeBtn" title="Volume">üîä</button>
                        <div class="volume-slider-container">
                            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
                        </div>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="progress-container">
                    <span class="time-display" id="currentTime">0:00</span>
                    <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
                    <span class="time-display" id="totalTime">0:00</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header" id="contentHeader">
                <h2 id="viewTitle">Songs</h2>
                <div class="header-actions">
                    <input type="text" class="search-box" id="searchBox" placeholder="Search songs...">
                </div>
            </div>
            
            <!-- Playlist Banner (shown when viewing a playlist) -->
            <div class="playlist-banner" id="playlistBanner" style="display: none;">
                <div class="banner-info">
                    <h3>
                        <span id="bannerPlaylistName"></span>
                        <button class="edit-playlist-name-btn" id="editPlaylistNameBtn" title="Edit playlist name">‚úé</button>
                    </h3>
                    <p id="bannerPlaylistStats"></p>
                </div>
            </div>
            
            <!-- Song Table -->
            <div class="table-container">
                <table class="song-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col"><input type="checkbox" id="selectAllCheckbox"></th>
                            <th class="number-col">#</th>
                            <th class="title-col">Name</th>
                            <th class="artist-col">Artist</th>
                            <th class="album-col">Album</th>
                            <th class="length-col">Length</th>
                        </tr>
                    </thead>
                    <tbody id="songTableBody">
                        <!-- Songs will be dynamically added here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Action Buttons (when songs are selected) -->
            <div class="action-panel" id="actionPanel" style="display: none;">
                <span id="selectedCount">0 songs selected</span>
                <button class="action-btn" id="compareBtn">Compare Selected</button>
                <button class="action-btn" id="addToPlaylistBtn">Add to Playlist</button>
                <button class="action-btn" id="removeFromPlaylistBtn" style="display: none;">Remove from Playlist</button>
                <button class="action-btn danger" id="deleteSelectedBtn">Delete</button>
            </div>
            
            <!-- Import Progress (bottom bar) -->
            <div class="import-progress" id="importProgress" style="display: none;">
                <div class="progress-info">
                    <span id="progressLabel">Importing files...</span>
                    <span id="progressStats">0/0</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                </div>
                <div class="progress-log" id="progressLog">
                    <!-- Log messages will appear here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="closeSettingsBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Library Management</h3>
                    <button class="settings-option-btn" id="importFilesBtn">üìÅ Import Songs/Folders</button>
                    <button class="settings-option-btn" id="relocateFolderBtn">üìÇ Relocate Music Folder</button>
                    <button class="settings-option-btn" id="setMusicFolderBtn">‚öôÔ∏è Set Music Folder Location</button>
                </div>
                
                <div class="settings-section">
                    <h3>Duplicate Management</h3>
                    <button class="settings-option-btn" id="manualCompareBtn">üîç Manual Duplicate Comparison</button>
                    <button class="settings-option-btn" id="findDuplicatesBtn">üîé Find Potential Duplicates</button>
                </div>
                
                <div class="settings-section">
                    <h3>Audio Settings</h3>
                    <label>MP3 Conversion Bitrate:</label>
                    <select id="bitrateSelect">
                        <option value="128">128 kbps</option>
                        <option value="192">192 kbps</option>
                        <option value="256" selected>256 kbps</option>
                        <option value="320">320 kbps</option>
                    </select>
                </div>
                
                <div class="settings-section">
                    <button class="settings-option-btn danger" id="exitAppBtn">‚ùå Exit Application</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Metadata Edit Modal -->
    <div class="modal" id="metadataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Metadata</h2>
                <button class="close-btn" id="closeMetadataBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="metadataForm">
                    <input type="hidden" id="editSongId">
                    
                    <label for="editTitle">Title:</label>
                    <input type="text" id="editTitle" required>
                    
                    <label for="editArtist">Artist:</label>
                    <input type="text" id="editArtist">
                    
                    <label for="editAlbum">Album:</label>
                    <input type="text" id="editAlbum">
                    
                    <label for="editYear">Year:</label>
                    <input type="number" id="editYear" min="1900" max="2100">
                    
                    <label for="editGenre">Genre:</label>
                    <input type="text" id="editGenre">
                    
                    <label for="editTrackNumber">Track Number:</label>
                    <input type="number" id="editTrackNumber" min="1">
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save Changes</button>
                        <button type="button" class="btn" id="cancelMetadataBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Playlist Modal -->
    <div class="modal" id="createPlaylistModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Create New Playlist</h2>
                <button class="close-btn" id="closePlaylistModalBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="createPlaylistForm">
                    <label for="playlistNameInput">Playlist Name:</label>
                    <input type="text" id="playlistNameInput" placeholder="Enter playlist name..." required autofocus>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Create Playlist</button>
                        <button type="button" class="btn" id="cancelPlaylistBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add to Playlist Modal -->
    <div class="modal" id="addToPlaylistModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Add to Playlist</h2>
                <button class="close-btn" id="closeAddToPlaylistBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <p id="addToPlaylistMessage">Select a playlist:</p>
                <div id="playlistSelectionList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Playlist buttons will be added here dynamically -->
                </div>
                <button class="btn" id="cancelAddToPlaylistBtn" style="margin-top: 15px; width: 100%;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Playlist Name Modal -->
    <div class="modal" id="editPlaylistNameModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Edit Playlist Name</h2>
                <button class="close-btn" id="closeEditPlaylistNameBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="editPlaylistNameForm">
                    <label for="editPlaylistNameInput">Playlist Name:</label>
                    <input type="text" id="editPlaylistNameInput" placeholder="Enter playlist name..." required autofocus>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save</button>
                        <button type="button" class="btn" id="cancelEditPlaylistNameBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Duplicate Comparison Modal -->
    <div class="modal" id="comparisonModal">
        <div class="modal-content" style="max-width: 1200px; width: 95%;">
            <div class="modal-header">
                <h2 id="comparisonTitle">Manual Duplicate Comparison</h2>
                <button class="close-btn" id="closeComparisonBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="comparison-container">
                    <table class="comparison-table" id="comparisonTable">
                        <!-- Table will be populated dynamically -->
                    </table>
                </div>
                <div class="form-actions" style="margin-top: 20px;">
                    <button class="btn primary" id="doneComparisonBtn">Done</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../audio/player.js"></script>
    <script src="renderer.js"></script>
</body>
</html>